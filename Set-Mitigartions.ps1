
# Copyright (c) 2020 Gurjit Singh

# This source code is licensed under the MIT license that can be found in
# the accompanying LICENSE file or at https://opensource.org/licenses/MIT.

#region Get-AnyKey
function Get-AnyKeyTo ($msg) {

    Write-Output "Press any key to $msg..."
    $null = $host.UI.RawUI.ReadKey("NoEcho,IncludeKeyDown")

}
#endregion


#region Get-Admin
function Get-Admin() {

    Begin {

        # Catch All Errors
        $ErrorActionPreference = "Stop"

    }

    process {
        if (!(([Security.Principal.WindowsIdentity]::GetCurrent()).Owner.Value.Equals("S-1-5-32-544"))) {

            try {

                $ProcParam = @{
                    FilePath = 'powershell'
                    ArgumentList = "-File `"$($MyInvocation.PSCommandPath)`" -NoExit"
                    Verb = 'runAs'

                }

                Start-Process @ProcParam

            }
            catch {

                Write-Output ("`n`nError: `n$($PSItem.Exception)`n" +
                    "`n$($PSItem.CategoryInfo)`n")

                # requires Get-AnyKeyTo.psm1 module
                Get-AnyKeyTo -msg "exit"
            }
            finally {
                $ErrorActionPreference = "Continue"
                Exit
            }
        }

    }

}

#endregion


# Elevate privileges
Get-Admin


Set-ProcessMitigation -PolicyFilePath $PSScriptRoot/Settings.xml


Get-AnyKeyTo("continue")

